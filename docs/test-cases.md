# 테스트 케이스 문서

## 테스트 전략

KNUT4 프로젝트는 다층 테스트 전략을 채택하여 애플리케이션의 품질과 안정성을 보장합니다.

### 테스트 피라미드

```
        E2E Tests (소수)
      ─────────────────
     Integration Tests (중간)
   ───────────────────────────
  Unit Tests (다수 - 70% 이상)
```

## 주요 테스트 시나리오

### 1. 사용자 인증 시나리오

#### 1.1 회원가입 테스트
**시나리오**: 신규 사용자가 계정을 생성한다
- **Given**: 유효한 사용자 정보 (username, email, password)
- **When**: POST /api/v1/auth/register 요청
- **Then**: 
  - 201 Created 응답
  - 사용자 정보가 데이터베이스에 저장
  - 비밀번호가 해싱되어 저장

**테스트 케이스**:
- [x] 유효한 정보로 회원가입 성공
- [ ] 중복 username으로 회원가입 실패 (409 Conflict)
- [ ] 중복 email로 회원가입 실패 (409 Conflict)
- [ ] 약한 비밀번호로 회원가입 실패 (400 Bad Request)
- [ ] 필수 필드 누락 시 회원가입 실패 (400 Bad Request)

#### 1.2 로그인 테스트
**시나리오**: 등록된 사용자가 로그인한다
- **Given**: 등록된 사용자 계정
- **When**: POST /api/v1/auth/login 요청
- **Then**: 
  - 200 OK 응답
  - JWT Access Token 반환
  - JWT Refresh Token 반환

**테스트 케이스**:
- [ ] 유효한 자격증명으로 로그인 성공
- [ ] 잘못된 비밀번호로 로그인 실패 (401 Unauthorized)
- [ ] 존재하지 않는 사용자로 로그인 실패 (401 Unauthorized)

#### 1.3 토큰 갱신 테스트
**시나리오**: 만료된 Access Token을 갱신한다
- **Given**: 유효한 Refresh Token
- **When**: POST /api/v1/auth/refresh 요청
- **Then**: 새로운 Access Token 반환

**테스트 케이스**:
- [ ] 유효한 Refresh Token으로 갱신 성공
- [ ] 만료된 Refresh Token으로 갱신 실패
- [ ] 잘못된 Refresh Token으로 갱신 실패

### 2. 사용자 프로필 관리 시나리오

#### 2.1 프로필 조회 테스트
**시나리오**: 인증된 사용자가 자신의 프로필을 조회한다
- **Given**: 인증된 사용자
- **When**: GET /api/v1/users/profile 요청
- **Then**: 사용자 프로필 정보 반환

**테스트 케이스**:
- [ ] 인증된 사용자의 프로필 조회 성공
- [ ] 인증되지 않은 요청 시 401 응답
- [ ] 유효하지 않은 토큰으로 요청 시 401 응답

#### 2.2 프로필 수정 테스트
**시나리오**: 인증된 사용자가 프로필을 수정한다
- **Given**: 인증된 사용자와 수정할 프로필 정보
- **When**: PUT /api/v1/users/profile 요청
- **Then**: 수정된 프로필 정보 반환

**테스트 케이스**:
- [ ] 유효한 정보로 프로필 수정 성공
- [ ] 잘못된 형식의 데이터로 수정 실패
- [ ] 인증되지 않은 요청 시 수정 실패

### 3. API 공통 테스트 시나리오

#### 3.1 인증 및 권한 테스트
**테스트 케이스**:
- [ ] JWT 토큰 없이 보호된 엔드포인트 접근 시 401 응답
- [ ] 만료된 JWT 토큰으로 접근 시 401 응답
- [ ] 권한이 없는 리소스 접근 시 403 응답

#### 3.2 입력 검증 테스트
**테스트 케이스**:
- [ ] 필수 필드 누락 시 400 응답과 적절한 에러 메시지
- [ ] 형식이 잘못된 데이터 입력 시 400 응답
- [ ] 길이 제한 초과 시 400 응답

#### 3.3 에러 처리 테스트
**테스트 케이스**:
- [ ] 존재하지 않는 리소스 조회 시 404 응답
- [ ] 서버 내부 오류 시 500 응답과 에러 로그
- [ ] 일관된 에러 응답 형식 (error code, message)

### 4. 통합 테스트 시나리오

#### 4.1 사용자 여정 테스트
**시나리오**: 신규 사용자의 전체 여정
1. 회원가입
2. 이메일 인증 (예정)
3. 로그인
4. 프로필 수정
5. 로그아웃

#### 4.2 데이터베이스 통합 테스트
**테스트 케이스**:
- [ ] 트랜잭션 롤백 동작 확인
- [ ] 외래키 제약조건 동작 확인
- [ ] 연관관계 매핑 동작 확인

### 5. 성능 테스트 시나리오

#### 5.1 부하 테스트
**테스트 케이스**:
- [ ] 동시 사용자 100명 기준 응답시간 측정
- [ ] API 처리량 (TPS) 측정
- [ ] 메모리 사용량 모니터링

#### 5.2 스트레스 테스트
**테스트 케이스**:
- [ ] 시스템 한계 지점 파악
- [ ] 장애 복구 시간 측정

### 6. E2E 테스트 시나리오

#### 6.1 브라우저 기반 테스트 (예정)
**시나리오**: 실제 브라우저에서 사용자 시나리오 테스트
- [ ] 회원가입 → 로그인 → 프로필 수정 플로우
- [ ] 다양한 브라우저에서 호환성 테스트

## 테스트 환경 설정

### 단위 테스트
- **도구**: JUnit 5, Mockito
- **실행**: `./gradlew test`
- **커버리지**: JaCoCo (목표 70% 이상)

### 통합 테스트
- **도구**: @SpringBootTest, TestContainers
- **데이터베이스**: H2 (인메모리) 또는 TestContainers PostgreSQL
- **실행**: `./gradlew integrationTest`

### E2E 테스트 (예정)
- **도구**: Playwright 또는 Cypress
- **환경**: Docker Compose 기반 테스트 환경

## 테스트 데이터 관리

### 1. 테스트 픽스처
- 표준화된 테스트 데이터 세트
- 테스트간 데이터 격리

### 2. 데이터베이스 정리
- 각 테스트 후 데이터 롤백
- @Transactional 및 @Rollback 활용

## CI/CD 테스트 자동화

### 1. GitHub Actions 워크플로우
- Pull Request 시 자동 테스트 실행
- 테스트 실패 시 머지 차단
- 테스트 결과 리포트 생성

### 2. 테스트 단계별 실행
```yaml
- Unit Tests (빠른 피드백)
- Integration Tests
- E2E Tests (배포 전 최종 검증)
```

## 테스트 메트릭

### 추적할 지표
- **코드 커버리지**: 라인/브랜치 커버리지
- **테스트 실행 시간**: 빌드 파이프라인 최적화
- **테스트 안정성**: Flaky test 비율
- **버그 탈출률**: 프로덕션에서 발견되는 버그 수

---

*이 문서는 테스트 케이스 구현과 함께 지속적으로 업데이트됩니다.*